/*
 * Copyright Â© 2019, SAS Institute Inc., Cary, NC, USA.  All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */
'use strict';

import setCookies from './setCookies';
let debug = require('debug')('codeauth');
async function codeAuth (options, req, h) {  
	debug('in codeauth');
	let cookieResult = await setCookies(options, req, h);
	debug('cookieResult:', cookieResult);
	
	let indexHTML = process.env.APPENTRY == null ? 'index.html' : process.env.APPENTRY;
	debug('indexHTML', indexHTML);
	if (process.env.REDIRECT !== undefined) {
		debug('..redirect',process.env.REDIRECT);
		debug('using REDIRECT env variable', process.env.REDIRECT);
		indexHTML = process.env.REDIRECT;
	}

	if (indexHTML.indexOf('/') === 0) {
		// added to support create-react-restaf-viya-app cli
		if (indexHTML !== '/develop') { 
			indexHTML = `/${process.env.APPNAME}/${indexHTML}`;
		}
		return { status: true, error: null , target: 'redirect', redirect: indexHTML};
	} else {
		// return h.file(indexHTML);
		console.log('redirecting to 		:', `/${indexHTML}`);
		return { status: true, error: null , target: 'file', redirect: indexHTML};
	}
	
	
}
export default codeAuth;
